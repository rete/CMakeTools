#!/bin/sh

CMAKE_ENVIRONMENT_FILE=@CMAKETOOLS_ENVIRONMENT_FILE@
ENVIRONMENT_NAMESPACE=@CMAKETOOLS_ENVIRONMENT_NAMESPACE@

rm -f $CMAKE_ENVIRONMENT_FILE

@CMAKETOOLS_ENV_PRECOMMAND@

cat << EOF > $CMAKE_ENVIRONMENT_FILE
# CMake file autogenerated
# DO NOT EDIT!!
# Import all environment variables into CMake properties

EOF

for e in `compgen -e`
do
        if [[ "$e" = "_" ]]
        then
                continue
        fi
        eval "value=\${$e}"
        echo $value | grep '${' > /dev/null
        if [[ "$?" = "0" ]]
        then
                continue
        fi
        echo "" >> $CMAKE_ENVIRONMENT_FILE
        echo "set_property( GLOBAL APPEND PROPERTY ${ENVIRONMENT_NAMESPACE}_ALL_VARS $e )"  >> $CMAKE_ENVIRONMENT_FILE
        echo "set_property( GLOBAL PROPERTY ${ENVIRONMENT_NAMESPACE}_$e \"$value\" )"  >> $CMAKE_ENVIRONMENT_FILE
done

exit 0
